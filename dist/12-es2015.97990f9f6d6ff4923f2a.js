(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{HLkr:function(e,t,c){"use strict";c.r(t),c.d(t,"EventsExamModule",(function(){return U}));var s=c("ofXK"),r=c("3Pt+"),i=c("AytR"),o=c("xKo/"),n=c.n(o),a=c("fXoL"),l=c("OaWH"),d=c("tyNb"),u=c("tk/3"),h=c("kmnG"),m=c("qFsG"),g=c("WU05");function b(e,t){if(1&e&&(a.ec(0,"div",19),a.ec(1,"h4"),a.ec(2,"b"),a.Wc(3,"\u0e40\u0e23\u0e34\u0e48\u0e21\u0e01\u0e32\u0e23\u0e2a\u0e2d\u0e1a : "),a.dc(),a.Wc(4),a.dc(),a.ec(5,"h4"),a.ec(6,"b"),a.Wc(7,"\u0e2a\u0e34\u0e49\u0e19\u0e2a\u0e38\u0e14\u0e01\u0e32\u0e23\u0e2a\u0e2d\u0e1a : "),a.dc(),a.Wc(8),a.dc(),a.dc()),2&e){const e=a.qc(3);a.Lb(4),a.Yc("",e.timeRemake(e.Getexamtopicdata.result[0].timeStart)," "),a.Lb(4),a.Yc("",e.timeRemake(e.Getexamtopicdata.result[0].timeEnd)," ")}}function p(e,t){if(1&e&&(a.ec(0,"h3",20),a.ec(1,"b"),a.Wc(2,"\u0e40\u0e27\u0e25\u0e32\u0e2a\u0e2d\u0e1a\u0e17\u0e35\u0e48\u0e40\u0e2b\u0e25\u0e37\u0e2d : "),a.dc(),a.Wc(3),a.dc()),2&e){const e=a.qc(3);a.Lb(3),a.Yc("",e.timeCountdow," ")}}function f(e,t){if(1&e){const e=a.fc();a.ec(0,"div",6),a.ec(1,"div",7),a.ec(2,"div",8),a.ec(3,"div",9),a.ec(4,"h3"),a.ec(5,"b"),a.Wc(6,"\u0e0a\u0e37\u0e48\u0e2d\u0e0a\u0e38\u0e14\u0e02\u0e49\u0e2d\u0e2a\u0e2d\u0e1a : "),a.dc(),a.Wc(7),a.dc(),a.ec(8,"h3"),a.ec(9,"b"),a.Wc(10,"\u0e01\u0e25\u0e38\u0e48\u0e21\u0e40\u0e23\u0e35\u0e22\u0e19 : "),a.dc(),a.Wc(11),a.dc(),a.ec(12,"h3"),a.ec(13,"b"),a.Wc(14,"\u0e04\u0e33\u0e2a\u0e31\u0e48\u0e07 : "),a.dc(),a.Wc(15),a.dc(),a.Uc(16,b,9,2,"div",10),a.Uc(17,p,4,1,"h3",11),a.dc(),a.ec(18,"h3",12),a.Wc(19,"\u0e42\u0e1b\u0e23\u0e14\u0e23\u0e30\u0e1a\u0e38\u0e23\u0e2b\u0e31\u0e2a\u0e40\u0e02\u0e49\u0e32\u0e2a\u0e2d\u0e1a"),a.dc(),a.ec(20,"form",13,14),a.mc("ngSubmit",(function(){a.Nc(e);const t=a.Kc(21),c=a.qc(2);return null!=c.countdownInterval?c.checkTopicpassword(t.value.password):""})),a.ec(22,"mat-form-field",15),a.ec(23,"mat-label"),a.Wc(24,"\u0e23\u0e2b\u0e31\u0e2a\u0e40\u0e02\u0e49\u0e32\u0e2a\u0e2d\u0e1a"),a.dc(),a.Zb(25,"input",16),a.dc(),a.ec(26,"div",17),a.ec(27,"button",18),a.Wc(28," \u0e15\u0e01\u0e25\u0e07 "),a.dc(),a.dc(),a.dc(),a.dc(),a.dc(),a.dc()}if(2&e){const e=a.qc(2);a.Lb(7),a.Yc("",e.Getexamtopicdata.result[0].exbody_head," "),a.Lb(4),a.Yc("",e.Getexamtopicdata.result[0].group_name," "),a.Lb(4),a.Yc("",e.Getexamtopicdata.result[0].topicText," "),a.Lb(1),a.yc("ngIf",null==e.countdownInterval),a.Lb(1),a.yc("ngIf",null!=e.countdownInterval),a.Lb(10),a.yc("disabled",null==e.countdownInterval||0==e.isIPAddress)}}function w(e,t){if(1&e&&(a.ec(0,"div",3),a.Zb(1,"div",4),a.Uc(2,f,29,6,"div",5),a.Zb(3,"div",4),a.dc()),2&e){const e=a.qc();a.Lb(2),a.yc("ngIf",e.Getexamtopicdata)}}const v=function(e){return{"border-primary":e}},y=function(e,t){return{"bg-success":e,"bg-danger":t}};function x(e,t){if(1&e){const e=a.fc();a.ec(0,"div",27),a.mc("click",(function(){a.Nc(e);const c=t.index;return a.qc(2).listSelect=c})),a.ec(1,"div",28),a.Wc(2),a.dc(),a.Zb(3,"div",29),a.dc()}if(2&e){const e=t.index,c=a.qc(2);a.yc("ngClass",a.Bc(3,v,c.listSelect==e)),a.Lb(2),a.Xc(e+1),a.Lb(1),a.yc("ngClass",a.Cc(5,y,c.answerFrom.get("answerList").controls[e].value.studentAnswer.length>0,c.answerFrom.get("answerList").controls[e].value.studentAnswer.length<=0))}}function L(e,t){if(1&e&&(a.ec(0,"th"),a.Wc(1),a.dc()),2&e){const e=t.$implicit;a.Lb(1),a.Yc(" ",e," ")}}function k(e,t){if(1&e&&(a.ec(0,"td"),a.Wc(1),a.dc()),2&e){const e=t.$implicit,c=a.qc().$implicit;a.Lb(1),a.Yc(" ",c[e]," ")}}function S(e,t){if(1&e&&(a.ec(0,"tr"),a.Uc(1,k,2,1,"td",43),a.dc()),2&e){const e=t.$implicit,c=a.qc(6);a.Lb(1),a.yc("ngForOf",c.getKeyObject(e))}}function T(e,t){if(1&e&&(a.ec(0,"table",42),a.ec(1,"thead"),a.ec(2,"tr"),a.Uc(3,L,2,1,"th",43),a.dc(),a.dc(),a.ec(4,"tbody"),a.Uc(5,S,2,1,"tr",43),a.dc(),a.dc()),2&e){const e=a.qc(3).$implicit,t=a.qc(2);a.Lb(3),a.yc("ngForOf",t.getKeyObject(t.service.jsParse(e.teacherResult).result)),a.Lb(2),a.yc("ngForOf",t.service.jsParse(e.teacherResult).result)}}function M(e,t){if(1&e&&(a.ec(0,"div"),a.ec(1,"h4",40),a.ec(2,"b"),a.Wc(3,"\u0e1c\u0e25\u0e25\u0e31\u0e1e\u0e18\u0e4c : "),a.dc(),a.dc(),a.Uc(4,T,6,2,"table",41),a.dc()),2&e){const e=a.qc(2).$implicit,t=a.qc(2);a.Lb(4),a.yc("ngIf",t.getKeyObject(t.service.jsParse(e.teacherResult).result).length>0)}}function W(e,t){if(1&e&&(a.ec(0,"div",39),a.Uc(1,M,5,1,"div",2),a.dc()),2&e){const e=a.qc().$implicit,t=a.qc(2);a.Lb(1),a.yc("ngIf",t.service.jsParse(e.teacherResult).isQuery)}}function I(e,t){1&e&&(a.ec(0,"p",20),a.Wc(1),a.dc()),2&e&&(a.Lb(1),a.Yc(" ","\u0e23\u0e39\u0e1b\u0e41\u0e1a\u0e1a\u0e04\u0e33\u0e2a\u0e31\u0e48\u0e07\u0e16\u0e39\u0e01\u0e15\u0e49\u0e2d\u0e07"," "))}function q(e,t){if(1&e&&(a.ec(0,"p",19),a.Wc(1),a.dc()),2&e){const e=a.qc(3);a.Lb(1),a.Yc(" ",e.sqlFormat.message," ")}}function O(e,t){if(1&e){const e=a.fc();a.ec(0,"div",30),a.ec(1,"div",31),a.ec(2,"div",7),a.ec(3,"div",8),a.ec(4,"h3"),a.ec(5,"b"),a.Wc(6,"\u0e2b\u0e19\u0e48\u0e27\u0e22\u0e01\u0e32\u0e23\u0e40\u0e23\u0e35\u0e22\u0e19\u0e23\u0e39\u0e49 : "),a.dc(),a.Wc(7),a.dc(),a.ec(8,"h3"),a.ec(9,"b"),a.Wc(10,"\u0e08\u0e38\u0e14\u0e1b\u0e23\u0e30\u0e2a\u0e07\u0e04\u0e4c : "),a.dc(),a.Wc(11),a.dc(),a.ec(12,"h3"),a.ec(13,"b"),a.Wc(14,"\u0e0a\u0e37\u0e48\u0e2d\u0e10\u0e32\u0e19\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25\u0e17\u0e35\u0e48\u0e43\u0e0a\u0e49 : "),a.dc(),a.Wc(15),a.dc(),a.ec(16,"h3",12),a.ec(17,"b"),a.Wc(18,"\u0e42\u0e08\u0e17\u0e22\u0e4c : "),a.dc(),a.dc(),a.Zb(19,"div",32),a.Uc(20,W,2,1,"div",33),a.ec(21,"h3",12),a.ec(22,"b"),a.Wc(23,"\u0e04\u0e30\u0e41\u0e19\u0e19 : "),a.dc(),a.Wc(24),a.dc(),a.ec(25,"div",34),a.ec(26,"h3"),a.ec(27,"b"),a.Wc(28,"\u0e04\u0e33\u0e41\u0e19\u0e30\u0e19\u0e33 (\u0e27\u0e34\u0e40\u0e04\u0e23\u0e32\u0e30\u0e2b\u0e4c\u0e08\u0e32\u0e01\u0e04\u0e33\u0e15\u0e2d\u0e1a)"),a.dc(),a.dc(),a.ec(29,"div",35),a.ec(30,"p",36),a.Wc(31),a.dc(),a.Uc(32,I,2,1,"p",11),a.Uc(33,q,2,1,"p",10),a.dc(),a.dc(),a.ec(34,"mat-form-field",15),a.ec(35,"mat-label"),a.Wc(36,"\u0e04\u0e33\u0e15\u0e2d\u0e1a"),a.dc(),a.ec(37,"textarea",37,38),a.mc("blur",(function(){a.Nc(e);const c=t.index,s=t.$implicit;return a.qc(2).onSubmitOneAnswer(c,s)}))("focus",(function(){a.Nc(e);const c=t.$implicit,s=a.Kc(38),r=a.qc(2);return r.answerKeyup(s.value,r.service.jsParse(c.keyword))}))("keyup",(function(){a.Nc(e);const c=t.$implicit,s=a.Kc(38),r=a.qc(2);return r.answerKeyup(s.value,r.service.jsParse(c.keyword))})),a.dc(),a.dc(),a.dc(),a.dc(),a.dc(),a.dc()}if(2&e){const e=t.$implicit,c=t.index,s=a.qc(2);a.yc("hidden",c!=s.listSelect),a.Lb(1),a.yc("formGroupName",c),a.Lb(6),a.Xc(e.unit_name),a.Lb(4),a.Xc(e.purpose_name),a.Lb(4),a.Xc(e.databaseName),a.Lb(4),a.yc("froalaView",e.text),a.Lb(1),a.yc("ngIf",s.service.jsParse(e.teacherResult)),a.Lb(4),a.Xc(e.score),a.Lb(1),a.yc("hidden","1"!=s.Getexamtopicdata.result[0].statusAdvice),a.Lb(6),a.Yc(" ","\u0e04\u0e33\u0e2a\u0e33\u0e04\u0e31\u0e0d\u0e17\u0e35\u0e48\u0e02\u0e32\u0e14 "+s.sqlFormat.keywordMissing," "),a.Lb(1),a.yc("ngIf",s.sqlFormat.isTrue),a.Lb(1),a.yc("ngIf",!s.sqlFormat.isTrue)}}function C(e,t){if(1&e){const e=a.fc();a.ec(0,"div"),a.ec(1,"form",21),a.mc("ngSubmit",(function(){return a.Nc(e),a.qc().onSubmitAnswer(!0)})),a.ec(2,"div",3),a.ec(3,"div",22),a.ec(4,"div",7),a.ec(5,"div",8),a.ec(6,"h3"),a.ec(7,"b"),a.Wc(8,"\u0e0a\u0e37\u0e48\u0e2d\u0e0a\u0e38\u0e14\u0e02\u0e49\u0e2d\u0e2a\u0e2d\u0e1a : "),a.dc(),a.Wc(9),a.dc(),a.ec(10,"h3"),a.ec(11,"b"),a.Wc(12,"\u0e01\u0e25\u0e38\u0e48\u0e21\u0e40\u0e23\u0e35\u0e22\u0e19 : "),a.dc(),a.Wc(13),a.dc(),a.ec(14,"h3"),a.ec(15,"b"),a.Wc(16,"\u0e04\u0e33\u0e2a\u0e31\u0e48\u0e07 : "),a.dc(),a.Wc(17),a.dc(),a.Zb(18,"hr"),a.ec(19,"div",17),a.ec(20,"h3"),a.ec(21,"b"),a.Wc(22,"\u0e40\u0e27\u0e25\u0e32\u0e2a\u0e2d\u0e1a\u0e17\u0e35\u0e48\u0e40\u0e2b\u0e25\u0e37\u0e2d"),a.dc(),a.dc(),a.Wc(23),a.dc(),a.ec(24,"div",17),a.Uc(25,x,4,8,"div",23),a.dc(),a.Zb(26,"hr"),a.ec(27,"div",17),a.ec(28,"button",24),a.Wc(29," \u0e2a\u0e34\u0e49\u0e19\u0e2a\u0e38\u0e14\u0e01\u0e32\u0e23\u0e17\u0e33\u0e41\u0e1a\u0e1a\u0e17\u0e14\u0e2a\u0e2d\u0e1a "),a.dc(),a.dc(),a.dc(),a.dc(),a.dc(),a.ec(30,"div",25),a.Uc(31,O,39,12,"div",26),a.dc(),a.dc(),a.dc(),a.dc()}if(2&e){const e=a.qc();a.Lb(1),a.yc("formGroup",e.answerFrom),a.Lb(8),a.Yc("",e.Getexamtopicdata.result[0].exbody_head," "),a.Lb(4),a.Yc("",e.Getexamtopicdata.result[0].group_name," "),a.Lb(4),a.Yc("",e.Getexamtopicdata.result[0].topicText," "),a.Lb(6),a.Yc(" ",e.timeCountdow," "),a.Lb(2),a.yc("ngForOf",e.Getexamtopicdata.topicData),a.Lb(6),a.yc("ngForOf",e.Getexamtopicdata.topicData)}}const P=new n.a({version:"5.7.7",mode:o.SqlMode.AnsiQuotes});window;let $=(()=>{class e{constructor(e,t,c,s,o){this.service=e,this.activeRoute=t,this.formBuilder=c,this.http=s,this.router=o,this.Getexamtopicdata=null,this.checkPassword=!0,this.countdownInterval=null,this.timeCountdow="00:00:00",this.isIPAddress=!1,this.listSelect=0,this.testSuccess=!1,this.sqlFormat={isTrue:!1,message:"",keywordMissing:""},this.answerKeyup=(e,t)=>{const c=P.parse(""+e);let s=[];null==c.parserError?(this.sqlFormat.isTrue=!0,t.forEach((c,r)=>{e.toLowerCase().includes((""+c).toLowerCase())||s.push(""+t[r])}),this.sqlFormat.keywordMissing=s.join(", ")):this.sqlFormat={isTrue:!1,message:c.parserError.message,keywordMissing:""}},this.timeRemake=e=>{let t=new Date(e);return`${t.getDate()} ${this.service.month[t.getMonth()]} ${t.getFullYear()+543}  ${t.getHours()}:${t.getMinutes()}`},this.testCountDown=(e,t,c)=>{let s=new Date(t).getTime(),r=new Date(e).getTime(),i=new Date(c).getTime(),o=s-r;this.testSuccess?this.service.showAlert("\u0e04\u0e38\u0e13\u0e17\u0e33\u0e02\u0e49\u0e2d\u0e2a\u0e2d\u0e1a\u0e0a\u0e38\u0e14\u0e19\u0e35\u0e49\u0e41\u0e25\u0e49\u0e27","\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e14\u0e39\u0e04\u0e30\u0e41\u0e19\u0e19\u0e44\u0e14\u0e49\u0e2b\u0e25\u0e31\u0e07\u0e08\u0e32\u0e01\u0e2b\u0e21\u0e14\u0e40\u0e27\u0e25\u0e32\u0e2a\u0e2d\u0e1a","error"):i-r>0?this.service.showAlert("\u0e22\u0e31\u0e07\u0e44\u0e21\u0e48\u0e16\u0e36\u0e07\u0e40\u0e27\u0e25\u0e32\u0e40\u0e02\u0e49\u0e32\u0e2a\u0e2d\u0e1a","","error"):this.countdownInterval=setInterval(()=>{r+=1e3,o=s-r,Math.floor(o/864e5);let e=Math.floor(o%864e5/36e5),t=Math.floor(o%36e5/6e4),c=Math.floor(o%6e4/1e3);this.timeCountdow=`${this.service.zeroPad(e,10)}:${this.service.zeroPad(t,10)}:${this.service.zeroPad(c,10)}`,o<0&&(clearInterval(this.countdownInterval),this.checkPassword=!0,this.countdownInterval=null,this.onSubmitAnswer(!1))},1e3)},this.onGetexamtopicdata=()=>{this.service.httpGet(`/extopic/getTopicData/${this.activeRoute.snapshot.paramMap.get("topicId")}/${this.service.localStorage.get("userLogin").uid}?token=${this.service.localStorage.get("userLogin").token}\n  `).then(e=>{if(e.success){if(this.Getexamtopicdata=e,e.topicData.forEach(e=>{"true"==e.isEnd&&(this.testSuccess=!0)}),""+e.result[0].limitIP=="0"?this.isIPAddress=!0:(""+e.MyIp).split(".")[0]!=(""+e.result[0].limitIP).split(".")[0]?(this.service.showAlert("\u0e44\u0e21\u0e48\u0e2d\u0e19\u0e38\u0e0d\u0e32\u0e15\u0e43\u0e2b\u0e49\u0e40\u0e02\u0e49\u0e32\u0e2a\u0e2d\u0e1a\u0e08\u0e32\u0e01\u0e40\u0e04\u0e23\u0e37\u0e2d\u0e02\u0e48\u0e32\u0e22\u0e02\u0e2d\u0e07\u0e04\u0e38\u0e13","","error"),this.isIPAddress=!1):this.isIPAddress=!0,this.testCountDown((""+this.Getexamtopicdata.getDateTime).replace(/ /g,"T"),""+this.Getexamtopicdata.result[0].timeEnd,""+this.Getexamtopicdata.result[0].timeStart),e.topicData.length>0){let t=this.answerFrom.get("answerList");e.topicData.forEach(e=>{t.push(this.formBuilder.group({stID_fk:this.service.localStorage.get("userLogin").uid,topicID_fk:[e.examtopicID,r.w.required],storeID_fk:[e.storeID,r.w.required],groupID_fk:this.service.localStorage.get("userLogin").groupid_fk,studentAnswer:[e.studentAnswer?e.studentAnswer:"",r.w.required],studentScore:[e.studentScore?e.studentScore:"",r.w.required],teacherScore:[e.teacherScore?e.teacherScore:"",r.w.required],stringMatch:[e.stringMatch?e.stringMatch:"",r.w.required],checkDetail:[e.checkDetail?e.checkDetail:"",r.w.required],isEnd:["false",r.w.required]}))})}}else this.service.showAlert("",e.massage,"error")})},this.checkTopicpassword=e=>{e==this.Getexamtopicdata.result[0].topicPassword?this.checkPassword=!1:this.service.showAlert("\u0e23\u0e2b\u0e31\u0e2a\u0e1c\u0e48\u0e32\u0e19\u0e44\u0e21\u0e48\u0e16\u0e39\u0e01\u0e15\u0e49\u0e2d\u0e07","","error")},this.onSubmitOneAnswer=(e,t)=>{let c=(""+this.answerFrom.get("answerList").controls[e].value.studentAnswer).replace(/,/g,", ").replace("( ","(").replace(" )",")").replace(/\n/g," ").replace(/\s\s+/g," "),s=(""+t.answer).replace(/,/g,", ").replace("( ","(").replace(" )",")").replace(/\s\s+/g," ").replace(/\n/g," "),r=[...[...JSON.parse(""+t.keyword)].map(e=>(""+e).toLowerCase())],o={arrayMatch:{teacherRow:[],studentRow:[],teacherColumn:[],studentColumn:[],isQueryMatch:!1,tableMatch:[]},keywordMatch:{keywordTeacher:r,keywordStudent:{},studentCount:0,percent:0},stringMatch:{percent:0,same:0}},n="",a=new Promise(e=>{if(s.toLowerCase().includes("select")){let n=new Promise(e=>{this.http.post(`${i.a.rootAPI}exdatabase/simquery?token=${this.service.localStorage.get("userLogin").token}`,JSON.stringify({sqldatabase:t.databaseName,sqlquery:c})).toPromise().then(t=>{t.success?(t.result.isQuery&&e({student:t.result}),e({student:null})):e({student:null})}).catch(()=>{e({student:null})})}),a=new Promise(e=>{this.http.post(`${i.a.rootAPI}exdatabase/simquery?token=${this.service.localStorage.get("userLogin").token}`,JSON.stringify({sqldatabase:t.databaseName,sqlquery:s})).toPromise().then(t=>{t.success?(t.result.isQuery&&e({teacher:t.result}),e({teacher:null})):e({teacher:null})}).catch(()=>{e({teacher:null})})});Promise.all([n,a]).then(t=>{const[c,s]=[...t],i=Object.assign({},c.student),n=Object.assign({},s.teacher);if(o.arrayMatch={teacherRow:n.result?n.result:[],studentRow:i.result?i.result:[],teacherColumn:this.getKeyObject(n.result?n.result:[]),studentColumn:this.getKeyObject(i.result?i.result:[]),isQueryMatch:!0,tableMatch:[]},o.arrayMatch.studentRow.length>0)if(r.includes("order by")){let t=[...new Set([...o.arrayMatch.teacherColumn,...o.arrayMatch.studentColumn])],c=!0;t.forEach((e,s)=>{""+o.arrayMatch.teacherColumn[s]==""+o.arrayMatch.studentColumn[s]&&null!=o.arrayMatch.teacherColumn[s]&&""!=o.arrayMatch.teacherColumn[s]?t[s]={col:""+e,match:!0}:(t[s]={col:""+e,match:!1},c=!1)}),o.arrayMatch.isQueryMatch=!!c&&((e,t)=>{if(e.length!=t.length)return!1;let c=e.map(e=>JSON.stringify(e)),s=t.map(e=>JSON.stringify(e));return!c.map((e,t)=>e==s[t]).includes(!1)})(o.arrayMatch.studentRow,o.arrayMatch.teacherRow),e(!0)}else o.arrayMatch.isQueryMatch=((e,t)=>{if(e.length!=t.length)return!1;let c=e.map(e=>JSON.stringify(e)).sort(),s=t.map(e=>JSON.stringify(e)).sort();return!c.map((e,t)=>e==s[t]).includes(!1)})(o.arrayMatch.studentRow,o.arrayMatch.teacherRow),e(!0);else o.arrayMatch.isQueryMatch=!1,e(!0)})}else e(!0)}),l=new Promise(e=>{let{keywordTeacher:t}=o.keywordMatch,{keywordStudent:s}=o.keywordMatch;t.forEach((e,t)=>{s[e]="sub query"==e?(c.toLowerCase().match(/select/g)||[]).length>1:c.toLowerCase().includes(e)}),Object.keys(s).forEach(e=>{s[e]&&(o.keywordMatch.studentCount+=1)}),o.keywordMatch.keywordStudent=s,o.keywordMatch.percent=o.keywordMatch.studentCount/t.length*100,e(!0)}),d=new Promise(e=>{let t=0;n=((e,c)=>{let s=function(e,t){let c=new Object,s=new Object;for(let r=0;r<e.length;r++)null==c[e[r]]&&(c[e[r]]={rows:new Array}),c[e[r]].rows.push(r);for(let r=0;r<t.length;r++)null==s[t[r]]&&(s[t[r]]={rows:new Array}),s[t[r]].rows.push(r);for(let r in s)1==s[r].rows.length&&void 0!==c[r]&&1==c[r].rows.length&&(t[s[r].rows[0]]={text:t[s[r].rows[0]],row:c[r].rows[0]},e[c[r].rows[0]]={text:e[c[r].rows[0]],row:s[r].rows[0]});for(let r=0;r<t.length-1;r++)null!=t[r].text&&null==t[r+1].text&&t[r].row+1<e.length&&null==e[t[r].row+1].text&&t[r+1]==e[t[r].row+1]&&(t[r+1]={text:t[r+1],row:t[r].row+1},e[t[r].row+1]={text:e[t[r].row+1],row:r+1});for(let r=t.length-1;r>0;r--)null!=t[r].text&&null==t[r-1].text&&t[r].row>0&&null==e[t[r].row-1].text&&t[r-1]==e[t[r].row-1]&&(t[r-1]={text:t[r-1],row:t[r].row-1},e[t[r].row-1]={text:e[t[r].row-1],row:r-1});return{o:e,n:t}}(""==e?[]:e.split(/\s+/),""==c?[]:c.split(/\s+/)),r="";if(0==s.n.length)for(let t=0;t<s.o.length;t++)r+="#DC3544,!-"+s.o[t]+" ";else{if(null==s.n[0].text)for(c=0;c<s.o.length&&null==s.o[c].text;c++)r+="#DC3544,!-"+s.o[c]+" ";for(let e=0;e<s.n.length;e++)if(null==s.n[e].text);else{let i="";for(c=s.n[e].row+1;c<s.o.length&&null==s.o[c].text;c++)i+="#DC3544,!-"+s.o[c]+" ";t+=1,r+="#2DA745,!-"+s.n[e].text+" "+i}}return r.replace(/\s\s+/g," ").replace(/\n/g," ")})(s.toLowerCase(),c.toLowerCase());let r=s.split(" "),i=c.split(" ");o.stringMatch.percent=t/(r.length>i.length?r.length:i.length)*100,o.stringMatch.same=t,e(!0)});Promise.all([a,l,d]).then(c=>{let r;if(s.toLowerCase().includes("select")&&o.arrayMatch.teacherRow.length>0&&o.arrayMatch.teacherColumn.length>0){let e=t.score/3;r=o.arrayMatch.isQueryMatch?2*e+e*o.keywordMatch.percent/100:e*o.keywordMatch.percent/100+e*o.stringMatch.percent/100}else{let e=t.score/2;r=e*o.keywordMatch.percent/100+e*o.stringMatch.percent/100}this.answerFrom.get("answerList").controls[e].patchValue({checkDetail:JSON.stringify(Object.assign({},o)),stringMatch:n,studentScore:r}),this.http.post(`${i.a.rootAPI}stTesting/insertOneAns?token=${this.service.localStorage.get("userLogin").token}`,JSON.stringify(this.answerFrom.value.answerList[e])).toPromise().then(e=>{}).catch(e=>{console.log(e)})})},this.onSubmitAnswer=(e=!1)=>{e?this.service.showConfirm("\u0e2a\u0e34\u0e49\u0e19\u0e2a\u0e38\u0e14\u0e01\u0e32\u0e23\u0e17\u0e33\u0e41\u0e1a\u0e1a\u0e17\u0e14\u0e2a\u0e2d\u0e1a","\u0e40\u0e27\u0e25\u0e32\u0e17\u0e35\u0e48\u0e40\u0e2b\u0e25\u0e37\u0e2d "+this.timeCountdow,"warning").then(e=>{e&&(this.answerFrom.get("answerList").controls.forEach((e,t)=>{this.answerFrom.get("answerList").controls[t].patchValue({isEnd:"true"})}),this.http.post(`${i.a.rootAPI}stTesting/insertAns?token=${this.service.localStorage.get("userLogin").token}`,JSON.stringify(this.answerFrom.value.answerList)).toPromise().then(e=>{window.close()}).catch(e=>{console.log(e)}))}):(this.answerFrom.get("answerList").controls.forEach((e,t)=>{this.answerFrom.get("answerList").controls[t].patchValue({isEnd:"true"})}),this.http.post(`${i.a.rootAPI}stTesting/insertAns?token=${this.service.localStorage.get("userLogin").token}`,JSON.stringify(this.answerFrom.value.answerList)).toPromise().then(e=>{}).catch(e=>{console.log(e)}))},this.getKeyObject=e=>{if(e){if(e.length>0){let t=[...e];return Object.keys(t[0])}return"object"==typeof e?Object.keys(e):[]}return[]}}ngOnInit(){this.onGetexamtopicdata(),this.service.showSidenav=!1,this.answerFrom=this.formBuilder.group({answerList:this.formBuilder.array([])})}}return e.\u0275fac=function(t){return new(t||e)(a.Yb(l.a),a.Yb(d.a),a.Yb(r.d),a.Yb(u.a),a.Yb(d.c))},e.\u0275cmp=a.Sb({type:e,selectors:[["app-exam-test"]],decls:3,vars:2,consts:[[1,"box-padding"],["class","row",4,"ngIf"],[4,"ngIf"],[1,"row"],[1,"col-lg-3","col-mb-2"],["class","col-lg-6 col-mb-8",4,"ngIf"],[1,"col-lg-6","col-mb-8"],[1,"card"],[1,"card-body"],[1,"mb-4"],["class","text-danger mt-3",4,"ngIf"],["class","text-success mt-3",4,"ngIf"],[1,"mb-3"],[3,"ngSubmit"],["cPass","ngForm"],["appearance","outline"],["matInput","","placeholder","\u0e23\u0e2b\u0e31\u0e2a\u0e40\u0e02\u0e49\u0e32\u0e2a\u0e2d\u0e1a","type","text","name","password","ngModel",""],[1,"text-center"],["type","submit",1,"btn","btn-primary","btn-sm",3,"disabled"],[1,"text-danger","mt-3"],[1,"text-success","mt-3"],[3,"formGroup","ngSubmit"],[1,"col-lg-3","mb-3"],["class","list-box border",3,"ngClass","click",4,"ngFor","ngForOf"],["type","submit",1,"btn","btn-primary","btn-sm"],[1,"col-lg-9","mb-3"],["class","card","formArrayName","answerList",3,"hidden",4,"ngFor","ngForOf"],[1,"list-box","border",3,"ngClass","click"],[1,"topBox","border-bottom"],[1,"bottomBox",3,"ngClass"],["formArrayName","answerList",1,"card",3,"hidden"],[3,"formGroupName"],[1,"mb-3","mt-3",3,"froalaView"],["style","overflow: auto","class","mb-2",4,"ngIf"],[1,"mt-3","mb-3","border","border-success","box-padding",2,"border-radius","5px",3,"hidden"],[1,"ml-3","mr-3"],[1,"text-danger"],["matInput","","placeholder","\u0e04\u0e33\u0e15\u0e2d\u0e1a","formControlName","studentAnswer","rows","4",3,"blur","focus","keyup"],["answerTextInput",""],[1,"mb-2",2,"overflow","auto"],[1,"mb-2"],["class","table table-sm table-bordered table-hover",4,"ngIf"],[1,"table","table-sm","table-bordered","table-hover"],[4,"ngFor","ngForOf"]],template:function(e,t){1&e&&(a.ec(0,"div",0),a.Uc(1,w,4,1,"div",1),a.Uc(2,C,32,7,"div",2),a.dc()),2&e&&(a.Lb(1),a.yc("ngIf",t.checkPassword),a.Lb(1),a.yc("ngIf",0==t.checkPassword))},directives:[s.m,r.x,r.q,r.r,h.b,h.f,m.b,r.b,r.p,r.s,r.h,s.l,s.k,r.c,r.i,g.c,r.g],styles:[".list-box[_ngcontent-%COMP%]{display:inline-block;width:40px;margin:5px;border-radius:5px;cursor:pointer}.list-box[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{height:25px;display:flex;align-items:center;justify-content:center}"]}),e})();var A=c("wZkO");const F=function(){return["/events/list"]},D=function(){return["/events/old"]};function R(e,t){if(1&e){const e=a.fc();a.ec(0,"div",9),a.ec(1,"h3",10),a.ec(2,"b"),a.Wc(3),a.dc(),a.dc(),a.ec(4,"div",0),a.ec(5,"div",11),a.ec(6,"h4"),a.ec(7,"b"),a.Wc(8,"\u0e01\u0e25\u0e38\u0e48\u0e21\u0e40\u0e23\u0e35\u0e22\u0e19 : "),a.dc(),a.Wc(9),a.dc(),a.ec(10,"h4"),a.ec(11,"b"),a.Wc(12,"\u0e04\u0e33\u0e2a\u0e31\u0e48\u0e07 : "),a.dc(),a.Wc(13),a.dc(),a.dc(),a.ec(14,"div",11),a.ec(15,"h4"),a.ec(16,"b"),a.Wc(17,"\u0e40\u0e23\u0e34\u0e48\u0e21\u0e01\u0e32\u0e23\u0e2a\u0e2d\u0e1a : "),a.dc(),a.Wc(18),a.dc(),a.ec(19,"h4"),a.ec(20,"b"),a.Wc(21,"\u0e2a\u0e34\u0e49\u0e19\u0e2a\u0e38\u0e14\u0e01\u0e32\u0e23\u0e2a\u0e2d\u0e1a : "),a.dc(),a.Wc(22),a.dc(),a.dc(),a.dc(),a.ec(23,"div",12),a.ec(24,"button",13),a.mc("click",(function(){a.Nc(e);const c=t.$implicit;return a.qc().openNewtab(c.examtopicID)})),a.Wc(25," \u0e40\u0e02\u0e49\u0e32\u0e2a\u0e2d\u0e1a "),a.dc(),a.dc(),a.dc()}if(2&e){const e=t.$implicit,c=t.index,s=a.qc();a.Lb(3),a.Zc("\u0e23\u0e32\u0e22\u0e01\u0e32\u0e23\u0e17\u0e35\u0e48 : ",c+1," (",e.exbody_head,")"),a.Lb(6),a.Xc(e.group_name),a.Lb(4),a.Xc(e.topicText),a.Lb(5),a.Xc(s.timeRemake(e.timeStart)),a.Lb(4),a.Xc(s.timeRemake(e.timeEnd))}}function G(e,t){if(1&e){const e=a.fc();a.ec(0,"div",10),a.ec(1,"h3",11),a.ec(2,"b"),a.Wc(3),a.dc(),a.dc(),a.ec(4,"div",0),a.ec(5,"div",12),a.ec(6,"h4"),a.ec(7,"b"),a.Wc(8,"\u0e01\u0e25\u0e38\u0e48\u0e21\u0e40\u0e23\u0e35\u0e22\u0e19 : "),a.dc(),a.Wc(9),a.dc(),a.ec(10,"h4"),a.ec(11,"b"),a.Wc(12,"\u0e04\u0e33\u0e2a\u0e31\u0e48\u0e07 : "),a.dc(),a.Wc(13),a.dc(),a.dc(),a.ec(14,"div",12),a.ec(15,"h4"),a.ec(16,"b"),a.Wc(17,"\u0e40\u0e23\u0e34\u0e48\u0e21\u0e01\u0e32\u0e23\u0e2a\u0e2d\u0e1a : "),a.dc(),a.Wc(18),a.dc(),a.ec(19,"h4"),a.ec(20,"b"),a.Wc(21,"\u0e2a\u0e34\u0e49\u0e19\u0e2a\u0e38\u0e14\u0e01\u0e32\u0e23\u0e2a\u0e2d\u0e1a : "),a.dc(),a.Wc(22),a.dc(),a.dc(),a.dc(),a.ec(23,"div",13),a.ec(24,"button",14),a.mc("click",(function(){a.Nc(e);const c=t.$implicit;return a.qc().historyTest(c)})),a.Wc(25," \u0e1c\u0e25\u0e01\u0e32\u0e23\u0e2a\u0e2d\u0e1a "),a.dc(),a.dc(),a.dc()}if(2&e){const e=t.$implicit,c=t.index,s=a.qc();a.Lb(3),a.Zc("\u0e23\u0e32\u0e22\u0e01\u0e32\u0e23\u0e17\u0e35\u0e48 : ",c+1," (",e.exbody_head,")"),a.Lb(6),a.Xc(e.group_name),a.Lb(4),a.Xc(e.topicText),a.Lb(5),a.Xc(s.timeRemake(e.timeStart)),a.Lb(4),a.Xc(s.timeRemake(e.timeEnd)),a.Lb(2),a.yc("disabled","0"==e.statusHistory)}}function N(e,t){if(1&e&&(a.ec(0,"div"),a.ec(1,"h4"),a.ec(2,"b"),a.Wc(3,"\u0e1c\u0e25\u0e01\u0e32\u0e23\u0e15\u0e23\u0e27\u0e08\u0e08\u0e32\u0e01\u0e23\u0e30\u0e1a\u0e1a : "),a.dc(),a.Wc(4),a.dc(),a.ec(5,"h4"),a.ec(6,"b"),a.Wc(7,"\u0e1c\u0e25\u0e01\u0e32\u0e23\u0e15\u0e23\u0e27\u0e08\u0e08\u0e32\u0e01\u0e2d\u0e32\u0e08\u0e32\u0e23\u0e22\u0e4c : "),a.dc(),a.Wc(8),a.dc(),a.dc()),2&e){const e=a.qc(2);a.Lb(4),a.Zc("",e.historyTestResult[0].sumstudentScore?e.subString(e.historyTestResult[0].sumstudentScore):0," / ",e.historyTestResult[0].exambodyScore," "),a.Lb(4),a.Zc("",e.historyTestResult[0].sumteacherScore?e.subString(e.historyTestResult[0].sumteacherScore):0," / ",e.historyTestResult[0].exambodyScore," ")}}function _(e,t){if(1&e){const e=a.fc();a.ec(0,"div",1),a.ec(1,"div",2),a.ec(2,"div",15),a.ec(3,"div",0),a.ec(4,"div",16),a.ec(5,"h2"),a.Wc(6,"\u0e1c\u0e25\u0e01\u0e32\u0e23\u0e2a\u0e2d\u0e1a"),a.dc(),a.ec(7,"h4"),a.Wc(8),a.dc(),a.dc(),a.ec(9,"div",17),a.ec(10,"div",7),a.ec(11,"button",18),a.mc("click",(function(){return a.Nc(e),a.qc().historySelected=null})),a.ec(12,"span",19),a.Wc(13,"\xd7"),a.dc(),a.dc(),a.dc(),a.dc(),a.dc(),a.Uc(14,N,9,4,"div",20),a.dc(),a.dc(),a.dc()}if(2&e){const e=a.qc();a.Lb(8),a.Yc("(",e.historySelected.exbody_head,")"),a.Lb(6),a.yc("ngIf",e.historyTestResult.length>0)}}const Y=[{path:"",component:(()=>{class e{constructor(e){this.service=e}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(a.Yb(l.a))},e.\u0275cmp=a.Sb({type:e,selectors:[["app-events-exam"]],decls:7,vars:6,consts:[["mat-tab-nav-bar","",1,"bg-white","box-shadow",2,"border","unset"],["mat-tab-link","","routerLinkActive","router-active",3,"routerLink"],[1,"box-padding"]],template:function(e,t){1&e&&(a.ec(0,"nav",0),a.ec(1,"a",1),a.Wc(2),a.dc(),a.ec(3,"a",1),a.Wc(4),a.dc(),a.dc(),a.ec(5,"div",2),a.Zb(6,"router-outlet"),a.dc()),2&e&&(a.Lb(1),a.yc("routerLink",a.Ac(4,F)),a.Lb(1),a.Yc(" ","\u0e23\u0e32\u0e22\u0e01\u0e32\u0e23\u0e2a\u0e2d\u0e1a"," "),a.Lb(1),a.yc("routerLink",a.Ac(5,D)),a.Lb(1),a.Yc(" ","\u0e1b\u0e23\u0e30\u0e27\u0e31\u0e15\u0e34\u0e01\u0e32\u0e23\u0e2a\u0e2d\u0e1a"," "))},directives:[A.b,d.e,A.a,d.d,d.g],styles:[".router-active[_ngcontent-%COMP%]{color:#007bff!important;font-weight:700;background-color:#eaeaea;border-bottom:3px solid #007bff;opacity:1!important}.mat-tab-link[_ngcontent-%COMP%]{color:#000;opacity:1!important}.mat-tab-link[_ngcontent-%COMP%]:hover{text-decoration:unset!important}"]}),e})(),children:[{path:"list",component:(()=>{class e{constructor(e){this.service=e,this.Topictestresult=[],this.currentTime=new Date,this.filterTopicList=e=>e.filter(e=>new Date(e.timeEnd).getTime()>this.currentTime.getTime()),this.openNewtab=e=>{window.open(i.a.url+"events/"+e,"","width=1024, height=728").onbeforeunload=()=>{window.location.reload()}},this.timeRemake=e=>{let t=new Date(e);return`${t.getDate()} ${this.service.month[t.getMonth()]} ${t.getFullYear()+543}  ${t.getHours()}:${t.getMinutes()}`},this.getCurrentTime=()=>{this.service.httpGet("/getDateTime?token="+this.service.localStorage.get("userLogin").token).then(e=>{this.currentTime=new Date((""+e.result).replace(/ /g,"T"))})},this.getTopictest=()=>{this.service.httpGet(`/extopic/getMyEventTopic/${this.service.localStorage.get("userLogin").groupid_fk}?token=${this.service.localStorage.get("userLogin").token}\n    `).then(e=>{e.success?this.Topictestresult=e.result:this.service.showAlert("",e.massage,"error")})}}ngOnInit(){this.getTopictest(),this.getCurrentTime()}}return e.\u0275fac=function(t){return new(t||e)(a.Yb(l.a))},e.\u0275cmp=a.Sb({type:e,selectors:[["app-events"]],decls:12,vars:1,consts:[[1,"row"],[1,"col-xl-6","mb-3"],[1,"card"],[1,"card-body",2,"padding","unset"],[2,"padding","20px"],[1,"col-7"],[1,"col-5"],[1,"text-right"],["class","list-examTopic-box",4,"ngFor","ngForOf"],[1,"list-examTopic-box"],[1,"mb-2"],[1,"col-6"],[1,"mt-3","text-right"],["type","button",1,"btn","btn-primary","btn-sm",3,"click"]],template:function(e,t){1&e&&(a.ec(0,"div",0),a.ec(1,"div",1),a.ec(2,"div",2),a.ec(3,"div",3),a.ec(4,"div",4),a.ec(5,"div",0),a.ec(6,"div",5),a.ec(7,"h2"),a.Wc(8,"\u0e23\u0e32\u0e22\u0e01\u0e32\u0e23\u0e2a\u0e2d\u0e1a\u0e17\u0e31\u0e49\u0e07\u0e2b\u0e21\u0e14"),a.dc(),a.dc(),a.ec(9,"div",6),a.Zb(10,"div",7),a.dc(),a.dc(),a.dc(),a.Uc(11,R,26,6,"div",8),a.dc(),a.dc(),a.dc(),a.dc()),2&e&&(a.Lb(11),a.yc("ngForOf",t.filterTopicList(t.Topictestresult)))},directives:[s.l],styles:[".list-examTopic-box[_ngcontent-%COMP%]{border-top:1px solid silver;padding:20px}.list-examTopic-box[_ngcontent-%COMP%]:hover{background-color:#fafafa}"]}),e})()},{path:"old",component:(()=>{class e{constructor(e){this.service=e,this.Topictestresult=[],this.currentTime=new Date,this.historySelected=null,this.historyTestResult=[],this.filterTopicList=e=>e.filter(e=>new Date(e.timeEnd).getTime()<=this.currentTime.getTime()),this.timeRemake=e=>{let t=new Date(e);return`${t.toISOString().split("T")[0]} ${t.getHours()}:${t.getMinutes()}`},this.getCurrentTime=()=>{this.service.httpGet("/getDateTime?token="+this.service.localStorage.get("userLogin").token).then(e=>{this.currentTime=new Date((""+e.result).replace(/ /g,"T"))})},this.getTopictest=()=>{this.service.httpGet(`/extopic/getMyEventTopic/${this.service.localStorage.get("userLogin").groupid_fk}?token=${this.service.localStorage.get("userLogin").token}\n    `).then(e=>{e.success?this.Topictestresult=e.result:this.service.showAlert("",e.massage,"error")})},this.historyTest=e=>{this.historySelected=e,console.log(e),this.service.httpGet(`stTesting/teacherGetHistory/${e.examtopicID}/${e.groupID_fk}?token=${this.service.localStorage.get("userLogin").token}`).then(e=>{e.success?e.result.length>0&&(this.historyTestResult=[...e.result.filter(e=>e.studentId==this.service.localStorage.get("userLogin").studentId)],console.log(this.historyTestResult)):this.service.showAlert("",e.massage,"error")})},this.subString=e=>String(e).length>4?String(e).substring(0,5):String(e)}ngOnInit(){this.getTopictest(),this.getCurrentTime()}}return e.\u0275fac=function(t){return new(t||e)(a.Yb(l.a))},e.\u0275cmp=a.Sb({type:e,selectors:[["app-events-old"]],decls:13,vars:2,consts:[[1,"row"],[1,"col-xl-6","mb-3"],[1,"card"],[1,"card-body",2,"padding","unset"],[2,"padding","20px"],[1,"col-7"],[1,"col-5"],[1,"text-right"],["class","list-examTopic-box",4,"ngFor","ngForOf"],["class","col-xl-6 mb-3",4,"ngIf"],[1,"list-examTopic-box"],[1,"mb-2"],[1,"col-6"],[1,"mt-3","text-right"],["type","button",1,"btn","btn-primary","btn-sm",3,"disabled","click"],[1,"card-body"],[1,"col-7","mb-3"],[1,"col-5","mb-3"],["type","button",1,"close",3,"click"],["aria-hidden","true"],[4,"ngIf"]],template:function(e,t){1&e&&(a.ec(0,"div",0),a.ec(1,"div",1),a.ec(2,"div",2),a.ec(3,"div",3),a.ec(4,"div",4),a.ec(5,"div",0),a.ec(6,"div",5),a.ec(7,"h2"),a.Wc(8,"\u0e1b\u0e23\u0e30\u0e27\u0e31\u0e15\u0e34\u0e01\u0e32\u0e23\u0e2a\u0e2d\u0e1a"),a.dc(),a.dc(),a.ec(9,"div",6),a.Zb(10,"div",7),a.dc(),a.dc(),a.dc(),a.Uc(11,G,26,7,"div",8),a.dc(),a.dc(),a.dc(),a.Uc(12,_,15,2,"div",9),a.dc()),2&e&&(a.Lb(11),a.yc("ngForOf",t.filterTopicList(t.Topictestresult)),a.Lb(1),a.yc("ngIf",t.historySelected))},directives:[s.l,s.m],styles:[".list-examTopic-box[_ngcontent-%COMP%]{border-top:1px solid silver;padding:20px}.list-examTopic-box[_ngcontent-%COMP%]:hover{background-color:#fafafa}"]}),e})()},{path:"",redirectTo:"/events/list",pathMatch:"full"}]},{path:":topicId",component:$}];let j=(()=>{class e{}return e.\u0275mod=a.Wb({type:e}),e.\u0275inj=a.Vb({factory:function(t){return new(t||e)},imports:[[d.f.forChild(Y)],d.f]}),e})();var E=c("+fd8");let U=(()=>{class e{}return e.\u0275mod=a.Wb({type:e}),e.\u0275inj=a.Vb({factory:function(t){return new(t||e)},imports:[[s.c,j,E.a]]}),e})()}}]);